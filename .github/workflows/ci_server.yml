# This workflow will do a clean install of node dependencies, build the source code and run tests when there is a pull request
# with changes within the "server" directory 

name: CI_SERVER

on:
  pull_request:
    branches: 
    - master 
    paths: 
    - 'server/**'
    - '!server/README.md'

jobs:
  build:

    runs-on: ubuntu-latest   

    strategy:
      matrix:
        node-version: [12.x]

    steps:
    - uses: actions/checkout@v2
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v1
      with:
        node-version: ${{ matrix.node-version }} 
    - run: npm --prefix ./server ci
    - run: npm --prefix ./server run build --if-present
    - run: npm --prefix ./server test
      env:
        CI: true
        SERVICE_ACCOUNT: 'eyJ0eXBlIjoic2VydmljZV9hY2NvdW50IiwicHJvamVjdF9pZCI6InRocmVhZGVyLTY5ZTgxIiwicHJpdmF0ZV9rZXlfaWQiOiIyMDJiMzAwMzEzNTdiMTg3YjY4MjNmMTVhNWI1ODQyMGMwMDY5MDVjIiwicHJpdmF0ZV9rZXkiOiItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2d0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktrd2dnU2xBZ0VBQW9JQkFRRFUxZFdmdzVnamVpTXdcbnZScUtBdzZ1Mk9jUTdETHRRY1o4dTZqdTh3b091QldmWGZwM3JRczdobHhmL3pxM2hGNEI2Q01UQzMwcjRBMnlcbmhhNllJS2Y0VXFzRlQ1L2hTT3VIaUlKVDRnSVdVYzU4YW5JOHFCVXNZcDZjMEtOS29FcHV6RHM3RHd5QXYxR0RcblkwRDJVN21SSFFmYkRFVkd0a1JHMmhxWjZwdm9mVFR1Qm9PNnlSMi80N1pKdmMrL3ZBSjhKMVpVTFJIejlkKzBcbjdVUnYyMUxTUUFUNzhNT3Z6U2U2bXE1LzNDZmk4UmJXeWc1TnNKamFqcks0SG1MaEZNTm12aGxZMHZKQUlLeUpcbk5FUFdJdmU2c3B5V1A0Tjgzdlc3QmlwVG5tbVM1aFQyM2tYZjd4Q1pMeEhIV3pSakVpclZOcFRXeEl6WkVNd2ZcbkMvS3dVNjZEQWdNQkFBRUNnZ0VBQmVUeUtKMkxIaGhvMXhXMW9YTGFPajlwanM5cnphUlBzZTZrakJHUkNyMVFcblkveC9Ua2N0azNWeUkzcDNEdFFNb25MaVhjbW9xc2xtdDdYNkV0NThxR1RwdFpqeDdaUk9hWTkvUklGeTIxbGlcbnBaRnhIbnJ0TXpCOEFnM0pKK3p1Z3NrSEx1aUl5UndEVHVjMXlseWhQQUtZMEJrejVmUndTYUlLc0k2TnlNOTVcbjZPYXdJaWxydEwzR0JvRXpsZmU2cVppcjJZdHcreFIxbnYrd1VLWXUwa25CcGlwQ1E0Tm4vZFpmT0hZZ3daaEhcbjZSdzFybXIybGFZaXJBR2hRK3BUSXIyUUlMR1dPck03TVVTMHVMMmlaQ1RKOXp2RHI0VWZNRXBVdkxyZ3VrVktcbmtSeE9YamdoYTZGenBvVUprR2EySzMxSEVBSkNqVWt6bFFRdk5KdGFpUUtCZ1FEK01lSFljOFkrditMK1dsY1JcbkE0bFQ4T21tSGQ2THR0aTFSRE0zcGNHdDI2dm56aGdJNmNQK2tZSWZ2cVFTcnQxNHpmTlpIcThxOWUyMkJzam9cbjBubmRnak9KbThMZ2IzNVh4SFhoQVpQa3dERXFKdUg1WStvMkxabVhudFM0VS9JVml6cHY1OVNPWHdINnU5QVFcbkRISFdVT2tlczlMK3pyaktYaHRxcjNMK1ZRS0JnUURXV01NUFRQK0JMbGJ1Vnduc2FSTzBJODU3QWN2WFJHTGlcbmxUYlZCejZJUTZaUllLTHVKWkl2NVh1MGxDME02N2JnMWVkaGRFOUphcW12elZ3UlVzbmNBcUJ4UEhma0UwaklcbkV3bjlFcEc4UkJ0UVRHeUFkMWZ4L1ROeCtZZ3VuWmZHcWJmd0lUZ0p6cE5QTDQzemVXME1zaFJtbExrT21SNHlcblBqamJaRHloZHdLQmdRQ2tSN0t4UkNtRVZsa3FqMUlqd2NoWUFxUE9ZeEYzOUNUY0NZYWNXVGp4MXIyajQxTXZcbk4zMGVvZ1daNUloL05wb1Z2K3ljMVRMYUxmU0NKcUpqcmR0cXFBSU0xaWk5Q2ZGNllaTFpaejZnb1FGbFA1bmRcbnBwQXdrWW5wTHBKRnlxTHkvM2MxNlhzNncvWXdpSDd3VUVxbCtzYWV2Qk1KOEtvR3g0a3FpdGRqdlFLQmdRREtcbjZNdit1QTFINU80MlFmOEs1WTNaZ2V2OVZmMzVrcXRwZzRlY3NuYm4xK0tpTnJFR2NGcXJMTHFtZjM4R05EMnpcbktjc1gzbHNRVFFERmc4b2NQQnNMUXhGUElNYitDYU5rZzJGNVNSTGMvanc5RDV2SElUTUh5WUhoNnk2WHNtZnpcbmtNYW5jMHJ4UGJVRnlTYS96YnNGd2E2K1RSdkNUZ0RmM3pkRHVPZ01rUUtCZ1FEbklsb3BzTmFFZkI5bi9oaEFcbkRUdHhHNWpGWEtVOXpzZ3diaVYwWDNHMTNKdTZjdmpXL1JjbXhNYUt0VE54cU9zYVlYM09xUWE0cG5OMUQ2S29cblpTVXlVdXhLUjZhVk14R2xlTW1WVksxT0NBanN3RngrR2lvMXpaYWRDZGU3bm14Zkd5SldVQSsrTmtDOEpUbzFcbmVZTkNmcW1CRjhtU3J0ZmxFaE5mOGwzRlBRPT1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsImNsaWVudF9lbWFpbCI6ImZpcmViYXNlLWFkbWluc2RrLXJmbnBnQHRocmVhZGVyLTY5ZTgxLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiY2xpZW50X2lkIjoiMTA0NzgzNDUxMzUxMzkzMjIxMzM4IiwiYXV0aF91cmkiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsInRva2VuX3VyaSI6Imh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjoiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwiY2xpZW50X3g1MDlfY2VydF91cmwiOiJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2ZpcmViYXNlLWFkbWluc2RrLXJmbnBnJTQwdGhyZWFkZXItNjllODEuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20ifQ=='
